<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Factory Dashboard</title>
  <link rel="stylesheet" href="dashboard.css?v=4">
</head>
<body>

  <!-- Header -->
  <header class="app-header">
    <div class="header-left">
      <h1>Factory Dashboard</h1>
    </div>
    <div class="header-center">
      <div class="search-wrapper">
        <input type="text" id="global-search" placeholder="Search SKU, lot, SO, customer, supplier..." autocomplete="off">
        <div id="search-results" class="search-dropdown hidden"></div>
      </div>
    </div>
    <div class="header-right">
      <button id="theme-toggle" class="btn-theme" title="Toggle light/dark mode">&#9790;</button>
      <button id="refresh-btn" class="btn-refresh" title="Refresh all data">Refresh</button>
      <span id="last-refreshed" class="refresh-ts"></span>
    </div>
  </header>

  <!-- Tabs -->
  <nav class="tab-bar">
    <button class="tab active" data-tab="operations">Operations</button>
    <button class="tab" data-tab="activity">Activity</button>
    <button class="tab" data-tab="notes">Notes</button>
    <button class="tab" data-tab="orders">Sales Orders</button>
  </nav>

  <!-- Tab A: Operations -->
  <main id="tab-operations" class="tab-content active">

    <!-- A1: Production Calendar -->
    <section class="section" id="section-production">
      <div class="section-header">
        <h2>Production Calendar</h2>
        <div class="calendar-controls">
          <button id="cal-prev" class="btn-sm" title="Previous">&larr;</button>
          <span id="cal-range-label"></span>
          <button id="cal-next" class="btn-sm" title="Next">&rarr;</button>
          <button id="cal-toggle" class="btn-sm">Month View</button>
        </div>
      </div>
      <div id="production-calendar" class="calendar-grid"></div>
      <div id="production-error" class="error-msg hidden"></div>
    </section>

    <!-- A2: Finished Goods On-Hand -->
    <section class="section" id="section-finished-goods">
      <h2>Finished Goods On-Hand</h2>
      <div id="finished-goods-panels"></div>
      <div id="finished-goods-error" class="error-msg hidden"></div>
    </section>

    <!-- A3: Batch Inventory -->
    <section class="section" id="section-batches">
      <h2>Batch Inventory On-Hand</h2>
      <div id="batch-inventory"></div>
      <div id="batches-error" class="error-msg hidden"></div>
    </section>

    <!-- A5: Ingredients -->
    <section class="section" id="section-ingredients">
      <h2>On-Hand Ingredients</h2>
      <div id="ingredients-panels"></div>
      <div id="ingredients-error" class="error-msg hidden"></div>
    </section>

  </main>

  <!-- Tab B: Activity -->
  <main id="tab-activity" class="tab-content">

    <!-- B1: Shipping Log -->
    <section class="section" id="section-shipments">
      <div class="collapsible-header expanded" data-panel="shipments-list">
        <h2>Shipping</h2>
        <span class="chevron"></span>
      </div>
      <div id="shipments-list" class="collapsible-body expanded">
        <div id="shipments-table"></div>
      </div>
      <div id="shipments-error" class="error-msg hidden"></div>
    </section>

    <!-- B2: Receiving Log -->
    <section class="section" id="section-receipts">
      <div class="collapsible-header expanded" data-panel="receipts-list">
        <h2>Receiving</h2>
        <span class="chevron"></span>
      </div>
      <div id="receipts-list" class="collapsible-body expanded">
        <div id="receipts-table"></div>
      </div>
      <div id="receipts-error" class="error-msg hidden"></div>
    </section>

  </main>

  <!-- Tab C: Notes / To-Dos / Reminders -->
  <main id="tab-notes" class="tab-content">

    <!-- Controls -->
    <div class="notes-toolbar">
      <div class="notes-filters">
        <button class="notes-filter-btn active" data-cat="all">All</button>
        <button class="notes-filter-btn" data-cat="note">Notes</button>
        <button class="notes-filter-btn" data-cat="todo">To-Dos</button>
        <button class="notes-filter-btn" data-cat="reminder">Reminders</button>
        <span class="notes-separator"></span>
        <label class="notes-toggle">
          <input type="checkbox" id="notes-show-done"> Show completed
        </label>
      </div>
      <button id="notes-add-btn" class="btn-refresh">+ New</button>
    </div>

    <!-- Notes List -->
    <div id="notes-list"></div>
    <div id="notes-error" class="error-msg hidden"></div>

  </main>

  <!-- Tab D: Sales Orders -->
  <main id="tab-orders" class="tab-content">

    <!-- Orders List View -->
    <div id="orders-list-view">
      <div class="orders-toolbar">
        <div class="orders-filters">
          <select id="orders-status-filter" class="orders-select">
            <option value="open" selected>All Open Orders</option>
            <option value="new">New</option>
            <option value="confirmed">Confirmed</option>
            <option value="in_production">In Production</option>
            <option value="ready">Ready</option>
            <option value="partial_ship">Partial Ship</option>
            <option value="shipped">Shipped</option>
            <option value="invoiced">Invoiced</option>
            <option value="cancelled">Cancelled</option>
            <option value="all">All Orders</option>
          </select>
          <input type="text" id="orders-customer-search" placeholder="Filter by customer..." autocomplete="off">
          <label class="orders-overdue-toggle">
            <input type="checkbox" id="orders-overdue-only"> Overdue only
          </label>
        </div>
        <button id="orders-refresh-btn" class="btn-refresh" title="Refresh orders">Refresh</button>
      </div>

      <section class="section" id="section-orders">
        <div id="orders-table-container"></div>
        <div id="orders-error" class="error-msg hidden"></div>
      </section>
    </div>

    <!-- Order Detail View (hidden by default) -->
    <div id="order-detail-view" class="hidden">
      <button id="order-back-btn" class="btn-back">&larr; Back to Orders</button>

      <section class="section" id="section-order-detail">
        <div id="order-detail-container"></div>
        <div id="order-detail-error" class="error-msg hidden"></div>
      </section>
    </div>

  </main>

  <!-- Note Create / Edit Modal -->
  <div id="note-modal-overlay" class="panel-overlay hidden" role="dialog" aria-label="Note editor">
    <div class="note-modal">
      <div class="panel-header">
        <h3 id="note-modal-title">New Item</h3>
        <button id="note-modal-close" class="btn-close" aria-label="Close">&times;</button>
      </div>
      <div class="note-modal-body">
        <div class="form-group">
          <label>Category</label>
          <div class="radio-group" id="note-cat-group">
            <label><input type="radio" name="note-cat" value="note" checked> Note</label>
            <label><input type="radio" name="note-cat" value="todo"> To-Do</label>
            <label><input type="radio" name="note-cat" value="reminder"> Reminder</label>
          </div>
        </div>
        <div class="form-group">
          <label for="note-title">Title</label>
          <input type="text" id="note-title" placeholder="What needs to be done?" autocomplete="off">
        </div>
        <div class="form-group">
          <label for="note-body">Details <span class="label-hint">(optional)</span></label>
          <textarea id="note-body" rows="3" placeholder="Additional details..."></textarea>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="note-priority">Priority</label>
            <select id="note-priority">
              <option value="low">Low</option>
              <option value="normal" selected>Normal</option>
              <option value="high">High</option>
            </select>
          </div>
          <div class="form-group">
            <label for="note-due">Due Date <span class="label-hint">(optional)</span></label>
            <input type="date" id="note-due">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="note-entity-type">Pin to <span class="label-hint">(optional)</span></label>
            <select id="note-entity-type">
              <option value="">None</option>
              <option value="product">Product</option>
              <option value="lot">Lot</option>
              <option value="customer">Customer</option>
              <option value="supplier">Supplier</option>
            </select>
          </div>
          <div class="form-group">
            <label for="note-entity-id">Entity Name / ID</label>
            <input type="text" id="note-entity-id" placeholder="e.g. Granola Classic 25 LB" autocomplete="off">
          </div>
        </div>
        <div class="form-actions">
          <button id="note-save-btn" class="btn-refresh">Save</button>
          <button id="note-cancel-btn" class="btn-sm">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Lot Detail Side Panel -->
  <div id="lot-panel-overlay" class="panel-overlay hidden" role="dialog" aria-label="Lot detail">
    <div class="lot-panel">
      <div class="panel-header">
        <h3 id="lot-panel-title">Lot Detail</h3>
        <button id="lot-panel-close" class="btn-close" aria-label="Close">&times;</button>
      </div>
      <div id="lot-panel-body" class="panel-body"></div>
    </div>
  </div>

  <script src="dashboard.js?v=6"></script>
</body>
</html>
